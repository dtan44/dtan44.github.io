<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>Speed Dating</title>

	<!--Libraries-->
    <script src="library/d3/d3.min.js" charset="utf-8"></script>
    <script src="library/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="library/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>

    <!--Stylesheets-->
    <link rel="stylesheet" type="text/css" href="library/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">

    <!--Font-->
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- vis classes-->
    <script src = "js/prefvis.js"></script>
    <script src = "js/matchvis.js"></script>
    <script src = "js/nodevis.js"></script>
    <script src = "js/mparvis.js"></script>
    <script src = "js/fparvis.js"></script>

</head>
<body>
    <div class ="row" id="topbar">
        <div class="topwrapper">
            <div class="col-md-12">
                Filter by Race:
                <label><input class="filter_race" type="checkbox" name="Black" id="Black" value="1"> African American </label>
                <label><input class="filter_race" type="checkbox" name="European" value="2"> Caucasian-American </label>
                <label><input class="filter_race" type="checkbox" name="Latino" value="3"> Latino/Hispanic </label>
                <label><input class="filter_race" type="checkbox" name="Asian" id="Asian" value="4"> Asian </label>
                <label><input class="filter_race" type="checkbox" name="Other" id="Other" value="6"> Other </label>
            
            <br>

            Filter by Occupation:
                <label><input class="filter_career" type="checkbox" name="Lawyer" id="Lawyers" value="1">Lawyer </label>
                <label><input class="filter_career" type="checkbox" name="Academic/Research" value="2">Academia </label>
                <label><input class="filter_career" type="checkbox" name="Doctor/Medicine" value="4">Medicine </label>
                <label><input class="filter_career" type="checkbox" name="Creative Arts/Entertainment" value="6"> Entertainment </label>
                <label><input class="filter_career" type="checkbox" name="Business" value="7">Business </label>
                <label><input class="filter_career" type="checkbox" name="International" value="9"> Humanitarian Affairs </label>
            
            <br>

            Filter by Goal:
                <label><input class="filter_goal" type="checkbox" name="Fun" id="Fun" value="1"> For Fun </label>
                <label><input class="filter_goal" type="checkbox" name="Meet" id="Meet" value="2"> Meet new people </label>
                <label><input class="filter_goal" type="checkbox" name="Date" value="3"> Get a date </label>
                <label><input class="filter_goal" type="checkbox" name="Serious" value="4"> Find serious relationship </label>
                <label><input class="filter_goal" type="checkbox" name="Say" value="5"> To say I did it </label>
                <label><input class="filter_goal" type="checkbox" name="Other" value="6"> Other </label>
            </div>
            <div class="selection">
                <b>current selection:</b> <span id="selectionInfo" style="background-color: lightgray"></span>
            </div>
            <div class="selection">
                <b>success rate:</b> <span id="matchInfo" style="background-color: lightgray"></span>
            </div>
            <div class="dropdown dropdown-dark">
                <select name="two" class="dropdown-select" onchange="changewave(value)">
                    <option value="0">Select a Dating Session</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="10">6</option>
                    <option value="11">7</option>
                    <option value="12">8</option>
                    <option value="13">9</option>
                    <option value="14">10</option>
                    <option value="15">11</option>
                    <option value="16">12</option>
                    <option value="17">13</option>
                    <option value="18">14</option>
                    <option value="19">15</option>
                    <option value="20">16</option>
                    <option value="21">17</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Title block -->
    <div class="title">
        <div class="col-md-4" id="title-left">
            <h1> Speed Dating </h1>
            <img src="image/couple.png" alt="Couple" style="width:200px; height:200px">
        </div>
        <div class="col-md-6 highlight" id="title-right">
            <br><br>
            <p> Still single? Haven't been successful in getting a match at a speed dating event? Learn the secrets to success in speed dating here. Find out what the opposite gender is looking for and explore why some people get matches and others don't.
            </p>
            <p> The first visualization shows you what people look for in the opposite gender and what people think the opposite gender looks for. (You can filter by race, occupation, and goal and the people who fit the criteria will be highlighted in the subsequent visualizations.) The second visualization shows you successful matches in a particular wave. (You can click on specific people and information about the person will appear on the side.) And the third visualizaiton shows you (1) preferences of the selected person from the second visualization compared to people of the same gender and (2) how that person views him/herself compared to how people of the opposite gender view him/her. (Clicking on a line and will highlighted the person in the second visualization.) Follow our narrative and click on the highlighted words to explore the relationships.
        </div>
    </div>

    <div class="horz_divider">
    </div>

    <!-- Narrative block -->
    <div class="left_column">
        <div class="vert_divider"></div>

        <div class="col-md-9" id='preferences'>
            <p>
                Participants were asked to distribute 100 points among 6 attributes, giving more points to those
                attributes that were more important to them in a potential date. On average, <mark onclick="text_click()">
                women weighted the attributes relatively evenly</mark>, with intelligence the most and ambition the least.
                <mark onclick="text_click()">Men weighted attractive the most and ambition the least</mark>. Interestingly,
                both genders thought the opposite gender would weight attractive more heavily and sincere and intelligent less.
            </p>
            <p>
                Among these speed daters, <mark onclick="lawyers()">lawyers seem to have the highest overall success rate</mark>.
                Surprisingly enough, a majority of the lawyers are here just "for fun". What does that imply?
            </p>
            <p>
                As for the different races, <mark onclick="asian()">Asians</mark> and <mark onclick="others()">"Others"</mark>
                have the lowest success rates.
            </p>
            <p>
                In general, most people came to speed dating <mark onclick="have_fun()">just to have fun</mark> or
                <mark onclick="meet_people()">meet new people</mark>. Nevertheless, that's not necessarily a bad thing
                for people looking for love as those that came with the intention of getting a date or finding a serious
                relationship have the highest success rates!
            </p>
            <p>
                There were 17 total speed dating sessions beginning from October 2002 and ending on April 2004.
                In each session, males rotated through the stations while females stayed stationary. Some sessions were
                <mark onclick="wave_success()">highly successful</mark> while in comparison, other waves were
                <mark onclick="wave_fail()">total misses</mark>.
            </p>
            <p>
                Looking at individual preferences, there does not seem to be a discernible pattern to how individuals
                compare to others within their own speed dating session. While one person may value one trait higher than
                others, it forces them to weight other traits less. However, looking at an individual's opinions about
                themselves leads to some interesting results.

                <br><br>
                Individuals who attend speed dating events
                <mark onclick="high_esteem()">tend to have high self esteem</mark> rarely rating themselves below 5.
                People are also <mark onclick="forgiving()">very forgiving of others</mark>, rarely rating others below
                5 as well.

                <br><br>
                Also of note, is that individual's who receive no matches often rate themselves much higher than what
                their fellow speed daters rated him or her. Take for example the
                <mark onclick="sess_10()">one person in session 10</mark> who got no matches or the
                <mark onclick="sess_11()">only dater in session 11</mark> who didn't get a match. Unlucky or unlikable?

                <br><br>
                Of course, the biggest question we are asking is, who got the most matches? And the winner is
                <mark onclick="female524()">female #524</mark> of session 17, who successfully matched with 14 other
                participants! What did she value the most? Intelligence! And what did other guys think of her? Most
                liked her, though 1 rated her 0 for every trait, while another didn't believe in her sincerity or
                ambition... I guess you getting 14 matches isn't ambitious enough.
            </p>

        </div>
    </div>

    <!-- Visualization block -->
    <div class="right_column">
        <div id="barcharts">
            <div id="prefVis">
                <h6 align="center">What One Looks for in the Opposite Gender</h6>
                <h6 align="center">vs What One Thinks the Opposite Gender Looks for</h6>
                <br>
            </div>
            <div id="matchVis">
                <h6 align="center">Number of Matches</h6>
                <br>
            </div>
        </div>
        
        <h4 style="text-align:center;"><b>Participants in Each Dating Sessions</b></h4>

        <div class="col-md-9" id="nodevis">
            <section id="nodelegend">
                <div class="legendbox">
                    <img src="image/boy.png" height="30" width="30">
                    <img src="image/girl.png" height="30" width="30">
                    <span>Participants</span>
                </div>
                <div class="legendbox">
                    <img src="image/boy_glow_green.png" height="30" width="30">
                    <img src="image/girl_glow_green.png" height="30" width="30">
                    <span>Filtered</span>
                </div>
                <div class="legendbox">
                    <img src="image/boy_glow.png" height="30" width="30">
                    <img src="image/girl_glow.png" height="30" width="30">
                    <span>Selected</span>
                </div>
            </section>
        </div>

        <div class="personinfo">
            <div id="personalbox"></div>
            <div id="linebox"></div>
        </div>

        <div class="inner_row">
            <div class="parcoordleft" id="mparVis"><center>Personal Preferences vs Others of the Same Gender</center></div>
            <div class="parcoordright" id="fparVis"><center>Opinion of Self vs Impression Left on Others</center></div>
        </div>
    </div>
    <div style="margin-left:35%">
<iframe width="50%" height="400" src="https://www.youtube.com/embed/9bh7TTVcYBo" frameborder="0" allowfullscreen></iframe>
</div>
	<script>

	    $(function(){

        var allData = [];
        var prefData = [];
     
        // call this function after Data is loaded, reformatted and bound to the variables
        var initVis = function(){

      	var MyEventHandler = new Object();

	     	pref_vis = new PrefVis(d3.select("#prefVis"), prefData, d3.select("#selectionInfo"));
            match_vis = new MatchVis(d3.select("#matchVis"), prefData, d3.select("#matchInfo"));
	     	node_vis = new NodeVis(d3.select("#nodevis"), allData, MyEventHandler);
            mpar_vis = new MParVis(d3.select("#mparVis"), allData, MyEventHandler);
            fpar_vis = new FParVis(d3.select("#fparVis"), allData, MyEventHandler);

	     	$(MyEventHandler).bind("nodeclick", function(event, id, wave_peep, node, wavenum){
				node_vis.updateInfo(node);
                mpar_vis.onSelectionChange(id, wave_peep, wavenum);
                fpar_vis.onSelectionChange(id, wave_peep, wavenum);
	     	});

            $(MyEventHandler).bind("lineclick", function (event, iid) {
                node_vis.linkClick(iid)
            });
        };
      
        // call this function after both files are loaded -- error should be "null" if no error
			var dataLoaded = function (error, datingdata) {

			    if (!error) {

				    var attrs = ['attr','sinc','intel','fun','amb','shar'];

				    function copy(source, target, prefix, suffix) {
					    attrs.forEach(function(attr) {
						    var key = attr+prefix+'_'+suffix;
						    if (source.hasOwnProperty(key)) { // copy if the property exists
							    target[key] = source[key];
						    }
					    });
				    }

				    // to unique iid entries
				    var uniquedata = d3.map(datingdata, function(d) { return d.iid; }).values();
				    var data = uniquedata.map(function(d) {
						var temp = {
							iid: d.iid,
							id: d.id,
							age: d.age,
							gender: d.gender,
							race: d.race,
							goal: d.goal,
							career_c: d.career_c,
							wave: d.wave,
							round: d.round,
							you_call: d.you_call,
							them_call: d.them_call,
							date_3: d.date_3,
							undergra: d.undergra,
							position: d.position,
							people: [],
							position1: d.positin1
						};

					    temp.start_pref = {};
					    // what the person looks for in the opposite sex (100 points)
					    copy(d, temp.start_pref, 1, 1);
					    // what the person thinks the opposite sex looks for (100 points)
					    copy(d, temp.start_pref, 2, 1);
					    // how the person rate him/herself (scale 1-10)
					    copy(d, temp.start_pref, 3, 1);
					    // how the person thinks others perceive him/her (scale 1-10)
					    copy(d, temp.start_pref, 5, 1);
					  
					    return temp;
					});

				    var lookup = d3.map(data, function(d) { return d.iid; });

			        datingdata.forEach(function(d) {
					var temp = {
						wave: d.wave,
						iid: d.iid,
						id: d.id,
						order: d.order,
						pid: d.pid,
						match: d.match,
						samerace: d.samerace,
						age_o: d.age_o,
						race_o: d.race_o,
						pf_o_attr: d.pf_o_attr,
						dec_o: d.dec_o,
						attr_o: d.attr_o,
						dec: d.dec,
						attr: d.attr,
						sinc: d.sinc,
						intel: d.intel,
						fun: d.fun,
						amb: d.amb,
						shar: d.shar,
						like: d.like,
						prob: d.prob,
						undergra: d.undergra,
						order: d.order,
						position: d.position
					};

					// lookup the corresponding data entry and push the people
					lookup.get(temp.iid).people.push(temp);
				});

				prefData = data;

				// group by wave
		        allData = d3.nest()
                        .key(function(d) { return d.wave;})
                        .entries(data);

                initVis();
            }
        };

      var startHere = function(){
				queue()
    			.defer(d3.csv, 'data/SpeedDating.csv')
    			.await(dataLoaded);
      }
      startHere();
	  })

		function update_races() {
			races = ["", "", "", "", ""]
			d3.selectAll("input").each(function(d, i) {
				if(d3.select(this).attr("class") == "filter_race" && d3.select(this).node().checked)
          races[i] = d3.select(this).attr("value");
			});
		};

		function update_careers() {
			careers = ["", "", "", "", "", ""];
			d3.selectAll("input").each(function(d, i) {
				if(d3.select(this).attr("class") == "filter_career" && d3.select(this).node().checked)
          careers[i-5] = d3.select(this).attr("value");
			});
		}

		function update_goals() {
			goals = ["", "", "", "", "", ""];
			d3.selectAll("input").each(function(d, i) {
				if(d3.select(this).attr("class") == "filter_goal" && d3.select(this).node().checked)
          goals[i-11] = d3.select(this).attr("value");
			});
		}

    // update chart if filter race button is changed
    d3.selectAll(".filter_race").on("change", function() {
        race_change();
    });

    // update chart if filter career button is changed
    d3.selectAll(".filter_career").on("change", function() {
    	career_change();
    });

		// update chart if filter goal button is changed
    d3.selectAll(".filter_goal").on("change", function() {
    	goal_change();
    });

	function changewave(value) {
	    wave_change(value);
	}

    function race_change() {
        update_races();
        pref_vis.onRaceChange(races);
        match_vis.onRaceChange(races);
        node_vis.onRaceChange(races);
        mpar_vis.onRaceChange(races);
        fpar_vis.onRaceChange(races);
    }

    function career_change() {
        update_careers();
        pref_vis.onCareerChange(careers);
        match_vis.onCareerChange(careers);
        node_vis.onCareerChange(careers);
        mpar_vis.onCareerChange(careers);
        fpar_vis.onCareerChange(careers);
    }

    function goal_change() {
        update_goals();
        pref_vis.onGoalChange(goals);
        match_vis.onGoalChange(goals);
        node_vis.onGoalChange(goals);
        mpar_vis.onGoalChange(goals);
        fpar_vis.onGoalChange(goals);
    }

    function wave_change(value) {
        pref_vis.onSelectionChange(value);
        match_vis.onSelectionChange(value);

        value = parseInt(value) - 1;

        if (value !== -1) {
            node_vis.wrangleData(value);
            node_vis.updateVis();
            mpar_vis.onWaveChange(value);
            fpar_vis.onWaveChange(value);
        }
    }

    function text_click() {
        $("input:checkbox").attr('checked', false);
        race_change()
        goal_change()
        career_change()
    }

    function wave_success() {
        $("input:checkbox").attr('checked', false);
        wave_change(14)
        race_change()
        goal_change()
        career_change()
    }

    function wave_fail() {
        $("input:checkbox").attr('checked', false);
        wave_change(18)
        race_change()
        goal_change()
        career_change()
    }

    function high_esteem() {
        $("input:checkbox").attr('checked', false);
        wave_change(11)
        race_change()
        goal_change()
        career_change()
    }

    function forgiving() {
        $("input:checkbox").attr('checked', false);
        wave_change(19)
        race_change()
        goal_change()
        career_change()
    }

    function sess_10() {
        $("input:checkbox").attr('checked', false);
        wave_change(14);
        race_change()
        goal_change()
        career_change()
        node_vis.nodePass(347, 13);
    }

    function sess_11() {
        $("input:checkbox").attr('checked', false);
        wave_change(15);
        race_change()
        goal_change()
        career_change()
        node_vis.nodePass(405, 14);
    }

    function lawyers() {
        $("input:checkbox").attr('checked', false);
        document.getElementById("Lawyers").checked = true;
        career_change();
        race_change()
        goal_change()
    }

    function asian() {
        $("input:checkbox").attr('checked', false);
        document.getElementById("Asian").checked = true;
        race_change();
        goal_change()
        career_change()
    }

    function others() {
        $("input:checkbox").attr('checked', false);
        document.getElementById("Other").checked = true;
        race_change();
        goal_change()
        career_change()
    }

    function have_fun() {
        $("input:checkbox").attr('checked', false);
        document.getElementById("Fun").checked = true;
        goal_change();
        race_change()
        career_change()
    }

    function meet_people() {
        $("input:checkbox").attr('checked', false);
        document.getElementById("Meet").checked = true;
        goal_change();
        race_change()
        career_change()
    }

    function female524() {
        $("input:checkbox").attr('checked', false);
        wave_change(20);
        race_change()
        goal_change()
        career_change()
        node_vis.nodePass(524, 20)
    }

	</script>
</body>
</html>